<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Scoreboard Overlay</title>
    <base href="/" />

    <!-- Only include the minimum required styles -->
    <link href="css/scoreboard.css" rel="stylesheet" />
    <link href="web_backend.Blazor.Client.styles.css" rel="stylesheet" />

    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            background-color: transparent !important;
        }

        #app {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent !important;
            overflow: hidden;
        }

        /* Hide the spinner to ensure clean loading */
        .spinner {
            display: none !important;
        }

        /* Hide any ABP or framework UI elements */
        .abp-application-layout,
        .navbar,
        .footer,
        .sidebar,
        .header,
        .notification-area,
        .admin-controls,
        .admin-panel {
            display: none !important;
        }

        /* Hide all elements except the scoreboard */
        body > *:not(#app),
        #app > *:not(.obs-overlay):not(.scoreboard-container):not(.obs-only-mode) {
            display: none !important;
        }

        /* Force transparent background */
        body, html, #app, .obs-overlay {
            background-color: transparent !important;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden !important;
        }

        /* Ensure timeout indicators are visible when active */
        .timeout-indicator.active {
            background-color: #ffcc00 !important;
        }

        /* Fix for potential z-index issues in OBS */
        .obs-overlay {
            z-index: 9999 !important;
        }

        /* Make sure text is legible on transparent background */
        .team-name, .team-score, .game-clock, .period-indicator {
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- The app will render the scoreboard here -->
    </div>

    <!-- ABP Framework scripts (minimal set) -->
    <script src="global.js"></script>

    <!-- Blazor WebAssembly script -->
    <script src="_framework/blazor.webassembly.js"></script>

    <script>
        // This script ensures OBS can access the scoreboard
        window.configureForOBS = function () {
            // Ensure transparent background
            document.body.style.background = 'transparent';
            document.documentElement.style.background = 'transparent';
            document.body.style.backgroundColor = 'transparent';
            document.documentElement.style.backgroundColor = 'transparent';

            // Remove any unwanted elements
            document.querySelectorAll('.abp-application-layout, .navbar, .footer, .sidebar, .header, .notification-area, .admin-controls, .admin-panel')
                .forEach(el => {
                    if (el) el.style.display = 'none';
                });

            // Add a special class to body
            document.body.classList.add('obs-mode');

            // Remove background color from ancestors
            let element = document.querySelector('.obs-overlay');
            while (element) {
                if (element.style) {
                    element.style.backgroundColor = 'transparent';
                    element.style.background = 'transparent';
                }
                element = element.parentElement;
            }

            console.log("OBS configuration applied");
        };

        window.notifyScoreboardLoaded = function () {
            console.log("Scoreboard loaded successfully");

            // Fix team logo sizes
            document.querySelectorAll('.team-logo img').forEach(img => {
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'contain';
                img.style.maxWidth = '32px';
                img.style.maxHeight = '32px';
            });
        };

        // Initial setup
        document.addEventListener('DOMContentLoaded', function () {
            // Force the URL to include admin=false for OBS usage
            const urlParams = new URLSearchParams(window.location.search);
            if (!urlParams.has('admin')) {
                urlParams.set('admin', 'false');
                const newUrl = window.location.pathname + '?' + urlParams.toString();
                history.replaceState(null, '', newUrl);
            }
        });
    </script>
</body>
</html>
